[![Backend CI](https://github.com/aelassas/bookcars/actions/workflows/backend.yml/badge.svg)](https://github.com/aelassas/bookcars/actions/workflows/backend.yml)
[![Frontend CI](https://github.com/aelassas/bookcars/actions/workflows/frontend.yml/badge.svg)](https://github.com/aelassas/bookcars/actions/workflows/frontend.yml) [![open in vscode](https://img.shields.io/badge/open%20in-vscode-1f425f.svg)](https://vscode.dev/github/aelassas/bookcars)

<p align="center">
  <img src="https://bookcars.github.io/content/bookcars.drawio.png" alt="" width="500" />
</p>

BookCars is an open source car rental platform, supplier oriented, with a backend for managing car fleet and bookings, a frontend and a mobile app for car rental.

# Features

* Supplier management
* Car fleet management
* Booking management
* Client management
* Multiple payment methods
* Multiple language support
* Responsive backend and frontend
* Native Mobile app for Android and iOS

# Download

You can download the latest release from [here](https://github.com/aelassas/bookcars/releases/latest).

# Install

You can find installation instructions [here](https://github.com/aelassas/bookcars/wiki/Installation).

# Build Mobile App

You can find instructions [here](https://github.com/aelassas/bookcars/wiki/Build-Mobile-App).

# Run from Code

You can find instructions in the [wiki](https://github.com/aelassas/bookcars/wiki/Run-from-code) to run BookCars from code.

# Documentation

You can find documentation [here](https://github.com/aelassas/bookcars/wiki).

# Overview

In this section, you'll see the main pages of the frontend, the backend and the mobile app.

## Frontend

From the frontend, the user can search for available cars, choose a car and checkout.

Below is the main page of the frontend where the user can choose a pickup and drop-off locations, dates and time booking, and search for available cars.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-1.png?raw=true)

Below is the search result of the main page where the user can choose a car for rental.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-2.png?raw=true)

Below is the checkout page where the user can set rental options and checkout. If the user is not registered, he can checkout and register at the same time. He will receive a confirmation and activation email to set his password if he is not registered yet.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-3.png?raw=true)

Below is the sign in page.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-4.png?raw=true)

Below is the sign up page.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-5.png?raw=true)

Below is page where the user can see and manage his bookings.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-6.png?raw=true)

Below is the page where the user can see a booking in detail.

![Frontend](https://github.com/aelassas/bookcars/blob/main/screenshots/frontend-7.png?raw=true)

That's it. That's the main pages of the frontend.

## Mobile App

<div>
  <p style="float: left; width: 100%"> 
From the mobile app, the user can search for available cars, choose a car and checkout.

The user can also receive push notifications, if the status of his booking is updated.

Below is the main page of the mobile app where the user can choose pickup and drop-off locations, dates and time booking, and search for available cars.
  </p>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-1.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-2.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-3.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>

  <p> 
  Below is the search result of the main page where user can choose a car for rental and checkout pages.
  </p>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-4.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-5.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-6.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-7.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <p> 
  Below are sign in and sign up pages.
  </p>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-8.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-9.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-10.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <p style="float: left; width: 100%"> 
  Below are the pages where the user can see and manage his bookings.
  </p>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-11.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-12.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-13.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-14.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-15.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <p> 
  Below are the pages where the user can update his profile information, change his password and see his notifications.
  </p>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-16.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-17.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-18.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
  <img src="https://github.com/aelassas/bookcars/blob/main/screenshots/mobileapp-19.jpg?raw=true" alt="" width="200" style="float: left; margin: 5px"/>
</div>

That's it for the main pages of the mobile app.

## Backend
BookCars is supplier oriented. This means that there are three types of users:

* Admin: He has full access to backend. He can do everything.
* Supplier: He has restricted access to backend. He can only manage his cars and bookings.
* User: He has only access to frontend and mobile app. He cannot access the backend.

BookCars is designed to work with multiple suppliers. Each supplier can manage his car fleet and bookings from the backend. BookCars can also work with only one supplier too.

From the backend, the admin user can create and manage suppliers, cars, locations, users and bookings.

When the admin user creates a new supplier, the supplier will receive an automatic email for creating his account to access the backend so he can manage his car fleet and bookings.

Below is the sign in page of the backend.

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-1.png?raw=true)

Below is the dashboard page of the backend where admins and suppliers can see and manage bookings.

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-2.png?raw=true)

Below is the page where car fleet is displayed and can be managed.

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-3.png?raw=true)

Below is the page where admins and suppliers can create new cars by providing an image and car info. 

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-4.png?raw=true)

Below is the page where admins and suppliers can edit cars.

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-5.png?raw=true)

Below is the page where admins can manage platform users.

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-6.png?raw=true)

Below is the page where to edit bookings.

![Backend](https://github.com/aelassas/bookcars/blob/main/screenshots/backend-7.png?raw=true)

That's it. That's the main pages of the backend.

# Architecture

This section describes the software architecture of BookCars including the API, the frontend, the mobile app and the backend.

BookCars API is built with Node.js, Express and MongoDB.

BookCars backend and frontend are built with Node.js, React and MUI.

BookCars mobile app is built with React Native and Expo.

## API

<p align="center">
  <img src="https://bookcars.github.io/content/bookcars-architecture.drawio.png?raw=true" alt="" width="500" />
</p>

BookCars API exposes all BookCars functions needed for the backend, the frontend and the mobile app. The API follows the MVC design pattern. JWT is used for authentication. There are some functions that need authentication and others that does not need authentication.

* *./api/models/* folder contains MongoDB models.
* *./api/routes/* folder contains Express routes.
* *./api/controllers/* folder contains controllers.
* *./api/middlewares/* folder contains middlewares.
* *./api/server.js* is the main server where database connection is established and routes are loaded.
* *./api/app.js* is the main entry point of BookCars API.

## Frontend

The frontend is a web application built with Node.js, ReactJS and MUI. From the frontend the user can search for available cars depending on pickup and drop-off locations, dates and time booking. He can then select his booking options and finally checkout.

* *./frontend/assets/* folder contains CSS and images.
* *./frontend/pages/* folder contains ReactJS pages.
* *./frontend/components/* folder contains ReactJS components.
* *./frontend/services/* contains BookCars API client services.
* *./frontend/App.js* is the main ReactJS App that contains routes.
* *./frontend/index.js* is the main entry point of the frontend.

## Mobile App

BookCars provides a native mobile app for Android and iOS. The mobile app is built with React Native and Expo. Like for the frontend, the mobile app allows the user to search for available cars depending on pickup and drop-off locations, dates and time booking. He can then select his booking options and finally checkout.

The user receives push notifications when his bookings are updated. Push notifications are built with Node.js, Expo Server SDK and Firebase.

* *./mobile/assets/* folder contains images.
* *./mobile/screens/* folder contains main pages.
* *./mobile/components/* folder contains React Native components.
* *./mobile/services/* contains BookCars API client services.
* *./mobile/App.js* is the main React Native App.
* *./mobile/index.js* is the main entry point of the mobile app.

## Backend

The backend is a web application built with Node.js, ReactJS and MUI. From the backend, the admin user can create and manage suppliers, cars, locations, users and bookings. When the admin user creates a new supplier, the supplier will receive an automatic email for creating his account to access the backend so he can manage his car fleet and bookings.

* *./backend/assets/* folder contains CSS and images.
* *./backend/pages/* folder contains ReactJS pages.
* *./backend/components/* folder contains ReactJS components.
* *./backend/services/* contains BookCars API client services.
* *./backend/App.js* is the main ReactJS App that contains routes.
* *./backend/index.js* is the main entry point of the backend.

---

Problems:
- no .env.example
- no scripts to auto-setup
- no env validation on startup
- overcomplicated .env eg.:

```typescript
const DB_USERNAME = process.env.BC_DB_USERNAME
const DB_PASSWORD = process.env.BC_DB_PASSWORD
const DB_APP_NAME = process.env.BC_DB_APP_NAME
const DB_NAME = process.env.BC_DB_NAME
const DB_URI = `mongodb://${encodeURIComponent(DB_USERNAME)}:${encodeURIComponent(DB_PASSWORD)}@${DB_HOST}:${DB_PORT}/${DB_NAME}?authSource=${DB_AUTH_SOURCE}&appName=${DB_APP_NAME}`
```

instead of simple

```typescript
const DB_URI = process.env.DB_URI;
```

- JS instead of Typescript
- mongoose instead of prisma
- no contract guards like ts-rest (require typescript)
- reCaptha enabled on localhost
- no seeds
- duplications that could be removed thanks to monorepo
- not handled Failed to load resource: net::ERR_TIMED_OUT in sign up form
- big duplications both in projects like signup and adminSignup in userController.js and cross projects like Helper.js
- awful code next to `fs.existsSync(avatar)`, mixing paths and urls, logic with moving files between cdn and temp cd in controller, duplications
- exotic ports instead of subdomains eg: `https://bookcars.com:81` instead of `https://backend.bookcars.com`
- Errors that could be avoided using silent happy path design, eg.:

```
POST /api/admin-sign-up/ with all correct data for login for existing user
```

gives `E11000 duplicate key error collection: bookcars.User` but it could return correct token to login

- many duplications in translations, eg repetitions in the same lang.:

```
ACCEPT_TOS: 'I read and agree with the Terms of Use.',
TOS: 'I read and agree with the Terms of Use.',
TOS: 'Terms of Service',
```

- infinite loading depending from number of elements on list, not request state
i mean (`if (companies.length > 0) {`) instead of `promise.state`, it will show "Loading..." forever if collection is empty

---

Changes in .env

Removed:
BC_DB_APP_NAME, BC_DB_USERNAME, BC_DB_PASSWORD, BC_DB_NAME, BC_DB_PORT, BC_DB_HOST, BC_DB_NAME

Docs about impact on mongo address (appName and authSource) https://www.mongodb.com/docs/manual/reference/connection-string/

Added:

BC_DB_URI

Recommendations:
-> move to monorepo - to remove cross projects duplications and simplify project setup process
-> remove scripts and move to docker -> to simplify deployment process
-> remove all ssl connected config from repo - it should be responsibility of nginx-proxy-automation
-> replace javascript by typescript - to improve contract and static analysis, error detection and autocompletion
-> replace mongose by prisma -> to improved db contract
-> add ts-rest -> to improve http contract
